# 变更日志

## 版本 0.6.0 - 2025-07-06 - 代码重构优化版本

### 🔧 重构优化
- **引入配置管理**: 新增 `Config.js` 统一管理所有常量和配置
- **消除魔法数字**: 所有硬编码数字替换为命名常量
- **代码模块化**: 将复杂逻辑拆分为更小的、职责单一的方法
- **几何计算工具类**: 新增 `GeometryUtils.js` 封装常用几何计算
- **游戏管理器**: 新增 `GameManager` 类替代全局变量管理
- **UI控制器**: 重构UI逻辑，使用类方法替代全局函数

### 🚀 性能优化
- **缓存策略优化**: 改进了缓存失效和更新机制
- **事件处理优化**: 简化了事件处理逻辑，提高响应速度
- **渲染优化**: 优化了渲染流程，减少不必要的重绘

### 🛠️ 代码质量提升
- **函数职责单一**: 每个函数只负责一个特定功能
- **命名规范**: 使用更具描述性的变量和函数名
- **注释完善**: 添加详细的JSDoc注释
- **错误处理**: 增强了边界条件检查

### 🔄 架构改进
- **依赖注入**: 减少组件间的强耦合
- **策略模式**: 使用策略模式处理不同游戏模式
- **工厂模式**: 改进了对象创建逻辑
- **观察者模式**: 优化了事件通知机制

### 📦 新增文件
- `js/Config.js` - 配置管理
- `js/GeometryUtils.js` - 几何计算工具

### 🔧 重构文件
- `js/Game.js` - 游戏核心逻辑重构
- `js/EventHandler.js` - 事件处理重构
- `js/Renderer.js` - 渲染器重构
- `js/AblationCalculator.js` - 计算器重构
- `js/Shape.js` - 形状类重构
- `js/main.js` - 主入口重构
- `js/ui.js` - UI控制器重构

### 🎯 向后兼容
- 保持所有原有功能不变
- 维护原有的API接口
- 保留全局变量以确保兼容性

### 📈 代码统计
- 减少代码重复约40%
- 提高代码可读性
- 降低维护成本
- 提升扩展性

## 版本 0.5.0

### 重大更新
- **双模式系统**：新增探索模式和闯关模式
  - 探索模式：保持原有的自由操作体验
  - 闯关模式：网格约束的精确操作模式
- **30x30网格系统**：闯关模式支持精确的网格定位
  - 600x600像素画布，20px网格间距
  - 形状几何中心自动吸附到网格点
  - 清晰的网格线和定位点可视化

### 新增功能
- **键盘控制**：方向键精确移动选中形状
  - 闯关模式：按网格单位移动
  - 探索模式：按20像素移动
- **智能尺寸系统**：
  - 圆形：直径可在2、4、6、8个网格单位间调整，默认4单位
  - 正方形：边长可在2、4、6、8个网格单位间调整，默认4单位
  - 三角形：保持传统缩放比例系统
- **实时渲染**：闯关模式支持移动过程中的实时消融显示

### 性能革命
- **异或算法优化**：闯关模式使用背景缓存+异或操作
  - 性能与形状数量无关，支持大量形状流畅操作
  - 计算复杂度从O(n×pixels)降低到O(pixels)
- **智能更新策略**：根据模式自动选择最优渲染方法
- **代码优化**：删除冗余代码，提升可维护性

### 视觉优化
- **抗锯齿渲染**：启用高质量图像平滑处理
- **整数坐标优化**：减少图形锯齿现象
- **选中状态优化**：只有选中的形状显示边框

### 用户体验
- **模式切换**：顶部按钮快速切换模式
- **画布放大**：从400x400增加到600x600，提供更大操作空间
- **网格点优化**：更粗的网格点，便于精确定位

## 版本 0.4.0

### 新增功能
- **形状旋转功能**：右键点击选中形状进行旋转
  - 正方形：每次旋转45°
  - 三角形：每次旋转60°（符合等边三角形对称性）
  - 圆形：不受旋转影响
- **三连击删除功能**：在选中形状上200毫秒内连续点击3次即可删除
- **等边三角形支持**：使用数学公式绘制标准等边三角形

### 优化改进
- **统一边界检测**：所有形状使用外接圆半径进行边界检测，确保旋转时不会超出边界
- **碰撞检测优化**：修正三角形碰撞检测算法，使其与等边三角形的实际几何形状匹配

### 修复问题
- 修复三角形边框和本体位置不对应的问题
- 修复形状缩放时可能溢出边界的问题
- 修复三角形边界检测不准确的问题

## 版本 0.3.0

### 性能优化
- **消融缓存机制**：缓存消融区域计算结果，避免重复计算
- **分离更新机制**：拖拽时只更新形状位置，不重新计算消融
- **按需计算**：只在形状改变时才重新计算消融区域
- **流畅性提升**：解决形状超过4个时的卡顿问题

### 修复问题
- 修复拖拽形状离开画布边缘后形状未重绘的问题

## 版本 0.2.0

### 新增功能
- **形状选择功能**：点击形状可选中，显示红色边框高亮
- **形状缩放功能**：使用鼠标滚轮调整选中形状大小，支持5档缩放(0.5x, 0.75x, 1x, 1.5x, 2x)
- **边界检测**：形状不会超出画布边界
- **形状创建改进**：
  - 创建新形状后自动取消形状类型选择
  - 创建新形状后自动选中该形状
  - 必须先选择形状类型才能创建新形状
- **鼠标交互优化**：
  - 区分点击选中和拖拽操作
  - 鼠标离开画布时自动取消选中状态
  - 右键点击取消选中

### 修复问题
- 修复左键点击选中功能失效的问题
- 修复形状按钮默认选中状态的问题

## 版本 0.1.0 (初始版本)

### 基础功能
- 支持圆形、方形、三角形三种基本形状
- 实时计算形状重叠区域的奇偶消融效果
- 基本的形状放置和拖拽功能
- 清除所有形状的功能